REPOSITORY_NAME,FOLDER_NAME,WORKFLOW_WORKLET_TYPE,WORKFLOW_WORKLET_PATH,WORKFLOW_WORKLET_NAME,SESSION_INSTANCE,MAPPING_MAPPLET_TYPE,MAPPING_MAPPLET_NAME,TRANSFORMATION_TYPE,TRANSFORMATION_NAME,SESSION_OR_MAPPING_LEVEL,PARAM_FILE_LOCATION,Parameter File Name,FROM_SQL_DB_TYPE,TO_SQL_DB_TYPE,SQL_TYPE,ORIGINAL_SQL_QUERY,ORIGINAL_SQL_QUERY_WITH_RESOLVED_PARAM,CONVERTED_SQL,CONVERSION_STATUS,CONFIDENCE_LEVEL,ERROR_CODE,ERROR_MESSAGE
REPO_SALES_MART,KPI_DM,Workflow,W_KPI_DM_MSST_KPITMGX,W_KPI_DM_MSST_KPITMGX,S_KPI_DM_MSST_KPITMGX_GUI,Mapping,M_KPI_DM_MSST_KPITMGX_GUI,Source Qualifier,SQO_CSCVGAL2,Mapping,Paratermeter.zip/staging/,P_OAT_DM_OATTSIT.TXT,Teradata,Google Bigquery,Pre SQL,"""SELECT
	REQ1.CDINTPRDDST (CHAR(13)) AS CDINTPRDDST ,
	REQ1.NUVARVTEDST (DECIMAL(5,0)) AS NUVARVTEDST,
	REQ2.CDBRC (CHAR(5)) AS CDBRC  ,
	REQ1.CDINTPRDREF (CHAR(13)) AS CDINTPRDREF,
	REQ2.LBPRD AS LBPRD,
	REQ2.CDFAM  (CHAR(13)) AS CDFAM,
	REQ2.LBFAM AS LBFAM,
	SUBSTR(REQ2.CDUEX,2,3) (CHAR(13)) AS CDUEX,
	REQ2.LBUEX AS LBUEX
FROM
(
	SELECT 
		CSCVGAL2.CDINTPRDDST AS CDINTPRDDST, 
		CSCVGAL2.NUVARVTEDST AS NUVARVTEDST, 
		CSCVGAL2.CDINTPRDREF AS CDINTPRDREF
	FROM 
		VUES_INF_DGI.CSCVGAL2
	WHERE 
		DTTRT = (SELECT MAX(DTTRT) FROM VUES_INF_DGI.CSCVGAL2)
) REQ1
LEFT JOIN
(
	SELECT
		UEX1.CDBRC,
		PDV1.CDINTPRD,
		PDV1.LBPRD,
		PDV1.CDFAM,
		FAM.LBFAM,
		UEX1.CDUEX,
		UEX1.LBUEX
	FROM
	(
		SELECT
			PDV.CDINTPRD,
			PDV.LBPRD,
			PDV.CDFAM
		FROM
		(
			SELECT 
				PRD.CDINTPRD AS CDINTPRD,
				PRD.LBVARVTE AS LBPRD,
				PRD.CDFAM AS CDFAM,
				PRD.DTSUPUNIVTE AS DTSUPUNIVTE,
				PRD.NUVARVTE
			FROM 
				VUES_DWH_SOCLE.REF_DIMVPDV3 PRD
			WHERE 
				PRD.ORDERVER = '1'
			QUALIFY 
				PRD.DTSUPUNIVTE = MAX(PRD.DTSUPUNIVTE)
			OVER 
			(
				PARTITION BY 
					PRD.CDINTPRD
			)
		) PDV
		QUALIFY
		    PDV.NUVARVTE = MIN(PDV.NUVARVTE)
		OVER 
		(
		    PARTITION BY 
		        PDV.CDINTPRD
		)
	) PDV1
	LEFT JOIN
	(
		SELECT
			CDFAM,
			LBFAM
		FROM
			VUES_DWH_SOCLE.REF_DIMVFAM3
		QUALIFY DTDEBAPPFAM = MAX(DTDEBAPPFAM) OVER (PARTITION BY CDFAM)
			AND DATE >= $$DTDEBAPPFAM
	) FAM
	ON
		PDV1.CDFAM = FAM.CDFAM
	LEFT JOIN
	(
		SELECT
			LUE.CDFAM,
			LUE.CDBRC,
			LUE.CDUEX,
			UEX.LBUEX
		FROM
		(
			SELECT 
				CDUEX,
				LBUEX
			FROM
				VUES_DWH_SOCLE.REF_DIMVUEX2
			WHERE
				SUBSTR(CDUEX,1,1) = 'G' OR SUBSTR(CDUEX,1,1) = 'S'
			QUALIFY DTDEBAPPUEX = MAX(DTDEBAPPUEX) OVER (PARTITION BY CDUEX)
				AND DATE >= $$DTDEBAPPUEX
		) UEX
		INNER JOIN
		(
			SELECT
				CDFAM,
				CDBRC,
				CDUEX
			FROM
				VUES_DWH_SOCLE.REF_DIMVLUE2
			WHERE
				CDBRC IN ('G', 'S')
			QUALIFY DDLIEUEXFAM = MAX(DDLIEUEXFAM) OVER (PARTITION BY CDFAM, CDBRC)
				AND DATE >= $$DDLIEUEXFAM
		) LUE
		ON
			UEX.CDUEX = LUE.CDUEX
	) UEX1
	ON
		UEX1.CDFAM = FAM.CDFAM
) REQ2
ON
	REQ1.CDINTPRDREF = REQ2.CDINTPRD
WHERE
	REQ2.CDBRC IS NOT NULL
ORDER BY
      	CDINTPRDDST ,
	NUVARVTEDST,
	CDBRC
--""","""SELECT
	REQ1.CDINTPRDDST (CHAR(13)) AS CDINTPRDDST ,
	REQ1.NUVARVTEDST (DECIMAL(5,0)) AS NUVARVTEDST,
	REQ2.CDBRC (CHAR(5)) AS CDBRC  ,
	REQ1.CDINTPRDREF (CHAR(13)) AS CDINTPRDREF,
	REQ2.LBPRD AS LBPRD,
	REQ2.CDFAM  (CHAR(13)) AS CDFAM,
	REQ2.LBFAM AS LBFAM,
	SUBSTR(REQ2.CDUEX,2,3) (CHAR(13)) AS CDUEX,
	REQ2.LBUEX AS LBUEX
FROM
(
	SELECT 
		CSCVGAL2.CDINTPRDDST AS CDINTPRDDST, 
		CSCVGAL2.NUVARVTEDST AS NUVARVTEDST, 
		CSCVGAL2.CDINTPRDREF AS CDINTPRDREF
	FROM 
		VUES_INF_DGI.CSCVGAL2
	WHERE 
		DTTRT = (SELECT MAX(DTTRT) FROM VUES_INF_DGI.CSCVGAL2)
) REQ1
LEFT JOIN
(
	SELECT
		UEX1.CDBRC,
		PDV1.CDINTPRD,
		PDV1.LBPRD,
		PDV1.CDFAM,
		FAM.LBFAM,
		UEX1.CDUEX,
		UEX1.LBUEX
	FROM
	(
		SELECT
			PDV.CDINTPRD,
			PDV.LBPRD,
			PDV.CDFAM
		FROM
		(
			SELECT 
				PRD.CDINTPRD AS CDINTPRD,
				PRD.LBVARVTE AS LBPRD,
				PRD.CDFAM AS CDFAM,
				PRD.DTSUPUNIVTE AS DTSUPUNIVTE,
				PRD.NUVARVTE
			FROM 
				VUES_DWH_SOCLE.REF_DIMVPDV3 PRD
			WHERE 
				PRD.ORDERVER = '1'
			QUALIFY 
				PRD.DTSUPUNIVTE = MAX(PRD.DTSUPUNIVTE)
			OVER 
			(
				PARTITION BY 
					PRD.CDINTPRD
			)
		) PDV
		QUALIFY
		    PDV.NUVARVTE = MIN(PDV.NUVARVTE)
		OVER 
		(
		    PARTITION BY 
		        PDV.CDINTPRD
		)
	) PDV1
	LEFT JOIN
	(
		SELECT
			CDFAM,
			LBFAM
		FROM
			VUES_DWH_SOCLE.REF_DIMVFAM3
		QUALIFY DTDEBAPPFAM = MAX(DTDEBAPPFAM) OVER (PARTITION BY CDFAM)
			AND DATE >= '01-JAN-2020'
	) FAM
	ON
		PDV1.CDFAM = FAM.CDFAM
	LEFT JOIN
	(
		SELECT
			LUE.CDFAM,
			LUE.CDBRC,
			LUE.CDUEX,
			UEX.LBUEX
		FROM
		(
			SELECT 
				CDUEX,
				LBUEX
			FROM
				VUES_DWH_SOCLE.REF_DIMVUEX2
			WHERE
				SUBSTR(CDUEX,1,1) = 'G' OR SUBSTR(CDUEX,1,1) = 'S'
			QUALIFY DTDEBAPPUEX = MAX(DTDEBAPPUEX) OVER (PARTITION BY CDUEX)
				AND DATE >= '01-JAN-2020'
		) UEX
		INNER JOIN
		(
			SELECT
				CDFAM,
				CDBRC,
				CDUEX
			FROM
				VUES_DWH_SOCLE.REF_DIMVLUE2
			WHERE
				CDBRC IN ('G', 'S')
			QUALIFY DDLIEUEXFAM = MAX(DDLIEUEXFAM) OVER (PARTITION BY CDFAM, CDBRC)
				AND DATE >= '01-JAN-2020'
		) LUE
		ON
			UEX.CDUEX = LUE.CDUEX
	) UEX1
	ON
		UEX1.CDFAM = FAM.CDFAM
) REQ2
ON
	REQ1.CDINTPRDREF = REQ2.CDINTPRD
WHERE
	REQ2.CDBRC IS NOT NULL
ORDER BY
      	CDINTPRDDST ,
	NUVARVTEDST,
	CDBRC
--""
",,,,,
REPO_SALES_MART,KPI_DM,Workflow,W_TCD_APP_MSMT_MGXTMVS,W_TCD_APP_MSMT_MGXTMVS,S_KPI_DM_P_KPITMGX_TMP,Mapping,M_KPI_DM_P_KPITMGX_TMP,Source Qualifier,SQO_REF_DIMVDAT2,Mapping,Paratermeter.zip/Dim/,P_IFS_AP_CASSE_KCFRAIS.TXT,Teradata,Google Bigquery,Pre SQL,"""SELECT
	CAST(
		(CASE 
		WHEN COUNT(*) <= 5 
		THEN ADD_MONTHS(DATE, -1) 
		ELSE DATE END)
		AS DATE FORMAT 'YYYYMM') (CHAR(6)
	) AS ANNEE_MOIS
FROM $$SCHEMA.REF_DIMVDAT2
WHERE ORJURFRE <> '1'
AND DTANN = EXTRACT(YEAR FROM DATE)
AND CDMOI = EXTRACT(MONTH FROM DATE)
AND DTDAT <= DATE""","SELECT
	CAST(
		(CASE 
		WHEN COUNT(*) <= 5 
		THEN ADD_MONTHS(DATE, -1) 
		ELSE DATE END)
		AS DATE FORMAT 'YYYYMM') (CHAR(6)
	) AS ANNEE_MOIS
FROM VUES_DWH_SOCLE.REF_DIMVDAT2
WHERE ORJURFRE <> '1'
AND DTANN = EXTRACT(YEAR FROM DATE)
AND CDMOI = EXTRACT(MONTH FROM DATE)
AND DTDAT <= DATE",,,,,
REPO_SALES_MART,OAT_DM,Workflow,W_OAT_DM_MSMT_LOT1,W_OAT_DM_MSMT_LOT1,S_OAT_DM_MSMT_OATTSIT,Mapping,M_OAT_DM_MSMT_OATTSIT,Source Qualifier,SQO_SRV_LFC_ILF,Mapping,Paratermeter.zip/DailyLoad/,P_OAT_DM_OATTSIT.TXT,Teradata,Google Bigquery,Pre SQL,"SELECT  DISTINCT
-- TRANSFORMER L?IMMAT 018 EN CODE 0
-- SINON TRANSFORMER 024 EN CODE 10
   SRV.CDSRV AS CDSIT, 
   LFC.LBLIGIDNADR1 AS LBSIT,
   CASE
      WHEN ILF.CDTYPIMMLFC = '024'
        THEN 10
      ELSE 0
    END AS CTSIT,
-- TRANSFORMER L?IMMAT 024 (ENTREPÔT)EN CODE 10
-- SINON TRANSFORMER 018 (MAGASIN) EN CODE 0
   ILF.CDIMMLIUFNC (CHAR(5))AS CDCLT,
   ILF.DTEFFIMMLFC  ,
  LFC.CDPYS            
FROM VUES_SIG.BETVSRV1 SRV,
     VUES_SIG.BETVLFC1  LFC,
     VUES_SIG.BETVILF1  ILF,
     VUES_SIG.BETVLLN1  LLN
WHERE SRV.CDTYPNUMLFC = LFC.CDTYPNUMLFC 
  AND SRV.NULIUFNC = LFC.NULIUFNC 
  AND ILF.CDTYPNUMLFC = SRV.CDTYPNUMLFC 
  AND ILF.NULIUFNC = SRV.NULIUFNC 
  AND ( (ILF.CDTYPIMMLFC = '018' and LLN.CDNATLIUFNC NOT LIKE ('ET%')) -- magasins
            OR (ILF.CDTYPIMMLFC ='024' and LLN.CDNATLIUFNC LIKE ('ET%')) ) -- entrepot 
  AND ( (CAST((ILF.DTMAJ (CHAR(10))) AS DATE FORMAT 'YYYY-MM-DD')  >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY')  AND
        (ILF.DTEFFIMMLFC < CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY') AND  
        (ILF.DTFINIMMLFC >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY')
            OR ILF.DTFINIMMLFC IS NULL) 
        )  
        ) 
 OR ( (ILF. DTEFFIMMLFC >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY') AND 
      ILF. DTEFFIMMLFC <= CAST('$$PARAM_DTJOURETL' AS DATE FORMAT 'DD/MM/YYYY'))  

        AND 
      (ILF.DTFINIMMLFC >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY') OR
         ILF.DTFINIMMLFC IS NULL) 
    ) 
      )
               -- POUR EXCLURE LES STATIONS SERVICE
      AND SRV.CDTYPNUMLFC = LLN.CDTYPNUMLFC 
      AND SRV.NULIUFNC     = LLN.NULIUFNC
      AND LLN.CDNATLIUFNC NOT IN ('43','44') 
      AND ( (LLN.DTDEBLIENLF < CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY')
	AND (LLN.DTFINLIENLF >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY') OR
            LLN.DTFINLIENLF IS NULL)) 
	OR	( (LLN.DTDEBLIENLF >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY') AND  
              LLN.DTDEBLIENLF  <= CAST('$$PARAM_DTJOURETL' AS DATE FORMAT 'DD/MM/YYYY')) 
	AND(LLN.DTFINLIENLF >= CAST('$$PARAM_DTOLDETL' AS DATE FORMAT 'DD/MM/YYYY') OR
             LLN.DTFINLIENLF IS NULL) ))
order by 1,2,3,5,4","SELECT  DISTINCT
-- TRANSFORMER L?IMMAT 018 EN CODE 0
-- SINON TRANSFORMER 024 EN CODE 10
   SRV.CDSRV AS CDSIT, 
   LFC.LBLIGIDNADR1 AS LBSIT,
   CASE
      WHEN ILF.CDTYPIMMLFC = '024'
        THEN 10
      ELSE 0
    END AS CTSIT,
-- TRANSFORMER L?IMMAT 024 (ENTREPÔT)EN CODE 10
-- SINON TRANSFORMER 018 (MAGASIN) EN CODE 0
   ILF.CDIMMLIUFNC (CHAR(5))AS CDCLT,
   ILF.DTEFFIMMLFC  ,
  LFC.CDPYS            
FROM VUES_SIG.BETVSRV1 SRV,
     VUES_SIG.BETVLFC1  LFC,
     VUES_SIG.BETVILF1  ILF,
     VUES_SIG.BETVLLN1  LLN
WHERE SRV.CDTYPNUMLFC = LFC.CDTYPNUMLFC 
  AND SRV.NULIUFNC = LFC.NULIUFNC 
  AND ILF.CDTYPNUMLFC = SRV.CDTYPNUMLFC 
  AND ILF.NULIUFNC = SRV.NULIUFNC 
  AND ( (ILF.CDTYPIMMLFC = '018' and LLN.CDNATLIUFNC NOT LIKE ('ET%')) -- magasins
            OR (ILF.CDTYPIMMLFC ='024' and LLN.CDNATLIUFNC LIKE ('ET%')) ) -- entrepot 
  AND ( (CAST((ILF.DTMAJ (CHAR(10))) AS DATE FORMAT 'YYYY-MM-DD')  >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY')  AND
        (ILF.DTEFFIMMLFC < CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY') AND  
        (ILF.DTFINIMMLFC >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY')
            OR ILF.DTFINIMMLFC IS NULL) 
        )  
        ) 
 OR ( (ILF. DTEFFIMMLFC >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY') AND 
      ILF. DTEFFIMMLFC <= CAST('17/06/2021' AS DATE FORMAT 'DD/MM/YYYY'))  

        AND 
      (ILF.DTFINIMMLFC >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY') OR
         ILF.DTFINIMMLFC IS NULL) 
    ) 
      )
               -- POUR EXCLURE LES STATIONS SERVICE
      AND SRV.CDTYPNUMLFC = LLN.CDTYPNUMLFC 
      AND SRV.NULIUFNC     = LLN.NULIUFNC
      AND LLN.CDNATLIUFNC NOT IN ('43','44') 
      AND ( (LLN.DTDEBLIENLF < CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY')
	AND (LLN.DTFINLIENLF >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY') OR
            LLN.DTFINLIENLF IS NULL)) 
	OR	( (LLN.DTDEBLIENLF >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY') AND  
              LLN.DTDEBLIENLF  <= CAST('17/06/2021' AS DATE FORMAT 'DD/MM/YYYY')) 
	AND(LLN.DTFINLIENLF >= CAST('16/06/2021' AS DATE FORMAT 'DD/MM/YYYY') OR
             LLN.DTFINLIENLF IS NULL) ))
order by 1,2,3,5,4",,,,,